<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Business AI Consultant</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #000;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: manipulation;
            background-image: url('img/consult.png');
            background-size: cover
        }
        .container {
            text-align: center;
            width: 100%;
            max-width: 600px;
        }
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        input[type="text"] {
            padding: 10px;
            font-size: 1em;
            width: 100%;
            max-width: 300px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #222;
            color: #fff;
        }
        button {
            padding: 10px 20px;
            font-size: 1.2em;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        #businessOutput {
            margin-top: 20px;
            text-align: left;
            max-width: 600px;
            width: 100%;
            max-height: 60vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .business-plan {
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
            background-color: #222;
            border-left: 4px solid #007BFF;
        }
        .error {
            color: #ff4d4d;
        }
        .loading {
            color: #007BFF;
        }
        .photo img {
          margin: 0 auto;
          display: block;
          width: 90%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Business AI Consultant</h1>
        <form id="businessForm" onsubmit="event.preventDefault(); generateBusinessPlan();">
            <input type="text" id="businessInput" name="idea" placeholder="Enter your business idea" required>
            <br>
            <button type="submit">Generate Business Plan</button>
            <button type="button" id="printBusinessPlan" disabled>Print Business Plan</button>
        </form>
        <div id="businessOutput"></div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;

        async function generateBusinessPlan() {
            const idea = document.getElementById('businessInput').value.trim();
            const outputDiv = document.getElementById('businessOutput');
            const printButton = document.getElementById('printBusinessPlan');
            if (!idea) {
                outputDiv.innerHTML = '<span class="error">Please enter a business idea.</span>';
                printButton.disabled = true;
                return;
            }

            outputDiv.innerHTML = '<span class="loading">Processing your request... This may take a few minutes as multiple AI models analyze your idea.</span>';
            printButton.disabled = true;

            try {
                const MODEL_CHAIN = [
                    { model: "psychologist", task: "Analyze consumer psychology, motivations, and market appeal of the business idea." },
                    { model: "gamemasterroleplaying", task: "Simulate user interactions and adoption challenges for this idea." },
                    { model: "chiefcustomersuccessofficer", task: "Evaluate customer success strategies and retention approaches for this idea." },
                    { model: "financialadvisor", task: "Assess financial viability, startup costs, revenue projections, and funding strategies." },
                    { model: "pythoncoderv2", task: "Draft a possible MVP or tech implementation strategy." },
                    { model: "cyberaisecurity", task: "Identify potential cybersecurity concerns or data privacy implications." },
                    { model: "projectmanager", task: "Propose a high-level project roadmap with phases and priorities." },
                    { model: "computerhardwareengineer", task: "Determine any hardware considerations and feasibility (skip if none)." },
                    { model: "businessadministrator", task: "Outline the business structure, roles, operations, and key workflows." },
                    { model: "attorney2", task: "Discuss legal structure, IP concerns, compliance, and liability mitigation." },
                    { model: "chiefaiofficer", task: "Provide high-level strategy for AI integration, scalability, and competitive edge. Note: if you determine AI is not needed for the business at this time but outline future integration." },
                ];

                const FINAL_OUTPUT_ROLES = {
                    contentsummarizer: "Give a brief statement introducing the board comprised of chiefcustomerofficer, financialadvisor, businessadministrator, attorney2, chiefaiofficer",
                    chiefcustomersuccessofficer: "Summarize the target market and the psychology of the potential consumer.",
                    financialadvisor: "Summarize the financial aspects, including budget, revenue model, projections, and liabilities of the business proposal.",
                    businessadministrator: "Summarize the operational structure and how this can run efficiently.",
                    attorney2: "Summarize legal safeguards, liabilities, and protections for this business.",
                    chiefaiofficer: "Summarize the long-term AI integration, risks, and opportunities.",
                    contentsummarizer: "Create a high-level overview summarizing the business proposalâ€™s key objectives, strategies, and value proposition. Clearly organize each roles report (financial advisor report, etc)",
                };

                let context = [{ role: 'user', content: idea }];
                for (const { model, task } of MODEL_CHAIN) {
                    const prompt = `Business idea: ${idea}\n\n${task}\n\nPrior context:\n${context.map(msg => `${msg.role}: ${msg.content}`).join('\n\n')}`;
                    const response = await fetch('http://192.168.1.32:8081/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: `${model}:latest`,
                            messages: [{ role: 'user', content: prompt }]
                        })
                    });
                    if (!response.ok) throw new Error(`Failed to fetch from ${model}: ${response.status}`);
                    const data = await response.json();
                    context.push({ role: 'assistant', content: data.message.content });
                }

                let combinedOutput = '';
                for (const [role, summaryPrompt] of Object.entries(FINAL_OUTPUT_ROLES)) {
                    const prompt = `Based on the analysis below:\n${context.map(msg => `${msg.role}: ${msg.content}`).join('\n\n')}\n\n${summaryPrompt}`;
                    const response = await fetch('http://192.168.1.32:8081/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: `${role}:latest`,
                            messages: [{ role: 'user', content: prompt }]
                        })
                    });
                    if (!response.ok) throw new Error(`Failed to fetch from ${role}: ${response.status}`);
                    const data = await response.json();
                    combinedOutput += `\n\n[${role}]: ${data.message.content}`;
                }

                outputDiv.innerHTML = `<div class="business-plan"><pre>${combinedOutput.trim()}</pre></div>`;
                printButton.disabled = false;
            } catch (error) {
                console.error('Error generating business plan:', error);
                outputDiv.innerHTML = `<span class="error">Error: ${error.message}. Please ensure the server is running at http://192.168.1.32:8081/api/chat.</span>`;
                printButton.disabled = true;
            }
        }

        function printBusinessPlan() {
            const outputDiv = document.getElementById('businessOutput');
            const idea = document.getElementById('businessInput').value.trim() || 'Business Plan';
            if (!outputDiv.innerText.trim()) {
                alert('No business plan content to print.');
                return;
            }

            const doc = new jsPDF();
            doc.setFontSize(12);
            doc.text('Business AI Consultant', 10, 10);
            doc.text(`Business Idea: ${idea}`, 10, 20);

            const text = outputDiv.innerText;
            const lines = doc.splitTextToSize(text, 190);
            let y = 30;
            lines.forEach(line => {
                if (y > 280) {
                    doc.addPage();
                    y = 10;
                }
                doc.text(line, 10, y);
                y += 7;
            });

            doc.save(`business_plan_${new Date().toISOString().replace(/[:.]/g, '-')}.pdf`);
        }

        document.getElementById('printBusinessPlan').addEventListener('click', printBusinessPlan);
    </script>
</body>
</html>
